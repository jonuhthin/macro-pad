# macro-pad

Arduino Pro Micro HID device to act as a secondary keyboard for controlling volume and other functions, like a numpad

## Goals:

- use these components:
  - rotary encoder
  - cherry/kailh switches (I had browns laying around)
  - OLED screen
  - Arduino Pro Micro

nice to haves:

- be cheapish (< $50 USD)
- multiple layers of keybindings
- easy to customize mappings

## Implementation

- Custom PCB via KiCAD

  - You can safely ignore this, but you might notice there are a couple extra components on the PCB in the picture below. Those are for a 3 pin switch and an MCP73831 charging circuit. I included these for testing a charging circuit with a lithium ion cell and to potentially use the extra PCBs I received to make the whole thing wireless.

  ![[pcb-extra-components.png]]

- 3d modeled/printed housing and keycaps on Fusion 360
- QMK Firmware
  - I forked the QMK Firmware and created a layout for this keyboard
### BOM

_Disclaimer: I prorated the costs for these components. A lot of them are easier/cheaper to buy in multiples, but I use the components for other projects as well so I had a lot of them already (including a 3d printer). After shipping, I'm positive this was no longer <$50.00, so please see this more as a rough estimate of where the costs were for me._

| Part Description                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             | Notes                                                                                                                                                                                                                          | Quantity | Total Price |
| -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ | -------- | ----------- |
| [Arduino Pro Micro](https://www.amazon.com/Teyleten-Robot-Bootloadered-Development-Microcontroller/dp/B08THVMQ46/ref=sr_1_1?crid=2VESLUXGU0N29&dib=eyJ2IjoiMSJ9.-hORpJsaUmiZ0DsxBhwltnZNUj96NW85UeZwIo4rCzSSD5IZJ2sQ8gR3akyhMcenOSP8NqMRcOHa2AP_5pMlEyGlhLkJ2gSFFIjhGe4lyhXQMHvHjqX4yFKkdq7h1H1a1aH4up-Rnf2nA0J-le_nhokiLFBPXCpjzcwTgPN8MOJMSTII0tUELs1rXE2TFy0hSmOPnfdzUMDdFU4aN-K7aQijzzNrcVrn42aWlh4boTbMW9m6hHN7ZdXmTZpA_cP4xhrr1GEdvoi87hhrpQQ1P_fH8KiM1B9NN2vwqEAYNq8.fBddrCWZP2I41st-l102FscxzcUn28_Y5U_SCSpWu38&dib_tag=se&keywords=pro+micro&qid=1722219576&s=electronics&sprefix=pro+micro%2Celectronics%2C85&sr=1-1 "https://www.amazon.com/Teyleten-Robot-Bootloadered-Development-Microcontroller/dp/B08THVMQ46/ref=sr_1_1?crid=2VESLUXGU0N29&dib=eyJ2IjoiMSJ9.-hORpJsaUmiZ0DsxBhwltnZNUj96NW85UeZwIo4rCzSSD5IZJ2sQ8gR3akyhMcenOSP8NqMRcOHa2AP_5pMlEyGlhLkJ2gSFFIjhGe4lyhXQMHvHjqX4yFKkdq7h1H1a1aH4up-Rnf2nA0J-le_nhokiLFBPXCpjzcwTgPN8MOJMSTII0tUELs1rXE2TFy0hSmOPnfdzUMDdFU4aN-K7aQijzzNrcVrn42aWlh4boTbMW9m6hHN7ZdXmTZpA_cP4xhrr1GEdvoi87hhrpQQ1P_fH8KiM1B9NN2vwqEAYNq8.fBddrCWZP2I41st-l102FscxzcUn28_Y5U_SCSpWu38&dib_tag=se&keywords=pro+micro&qid=1722219576&s=electronics&sprefix=pro+micro%2Celectronics%2C85&sr=1-1") | I used female pin headers to make the Pro Micro removable, if you don't use these you'll have to make adjustments to the model.                                                                                                | 1        | $6.29       |
| [Keyboard Switches](https://kbdfans.com/products/pls-do-not-delete-it-switch-option?_pos=7&_sid=81fc3dcd6&_ss=r&variant=39912664400011 "https://kbdfans.com/products/pls-do-not-delete-it-switch-option?_pos=7&_sid=81fc3dcd6&_ss=r&variant=39912664400011")                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 | in my unprofessional opinion Gateron Yellows are the best value                                                                                                                                                                | 24       | $12.00      |
| [Rotary Encoder](https://www.amazon.com/Taiss-KY-040-Encoder-15%C3%9716-5-Arduino/dp/B07F26CT6B/ref=sr_1_2?dib=eyJ2IjoiMSJ9._s_FAhQr5PXlpTlOwNHvqxmNA_MXwOl_jKs_jX3zJP7OJPz78ybawFVX0qSHNl2IasIoPGXKgUDcxqB7WA0d5kgVVaADePFuRu5wHY0zLX0WsCfX_SuV0RAfCQ8t_e1JkH3_5Sdt8eAJ-80cS48xVpIyDNpS-LPlC3YPqvNwKxvV-GB5PRP7kqD1ljZPWhmqhTApwesUuD1jy6M_ZphAQhH6hq61gIClUBTqUBOLo1I._kYZ8rHNrynXbxVer7p3wGNRw9rx6ABgCqcK-rkMm4w&dib_tag=se&keywords=rotary+encoder&qid=1722470599&sr=8-2 "https://www.amazon.com/Taiss-KY-040-Encoder-15%C3%9716-5-Arduino/dp/B07F26CT6B/ref=sr_1_2?dib=eyJ2IjoiMSJ9._s_FAhQr5PXlpTlOwNHvqxmNA_MXwOl_jKs_jX3zJP7OJPz78ybawFVX0qSHNl2IasIoPGXKgUDcxqB7WA0d5kgVVaADePFuRu5wHY0zLX0WsCfX_SuV0RAfCQ8t_e1JkH3_5Sdt8eAJ-80cS48xVpIyDNpS-LPlC3YPqvNwKxvV-GB5PRP7kqD1ljZPWhmqhTApwesUuD1jy6M_ZphAQhH6hq61gIClUBTqUBOLo1I._kYZ8rHNrynXbxVer7p3wGNRw9rx6ABgCqcK-rkMm4w&dib_tag=se&keywords=rotary+encoder&qid=1722470599&sr=8-2")                                                                                                                                                                                                                                                                                                  | I had the kind linked with the breakout board, but if I had the chance I'd adjust the PCB to use one without a breakout like these [PEC12R](https://www.digikey.com/en/products/detail/bourns-inc/PEC12R-4225F-S0024/4499648)s | 1        | $2.00       |
| [SSD1306 OLED](https://www.amazon.com/Teyleten-Robot-Display-SSD1306-Raspberry/dp/B08ZY4YBHL/ref=sr_1_6?crid=1X1ODCPMBG4T7&dib=eyJ2IjoiMSJ9.l-FK2pxw8wWhZ_wtkFb4O317I1KcEin8dQMamdyEitE9LRh2ASA0jqjkAPis8a7H8O0BVjGwVcOVrv74dr2MPFvqay2peW42GiRTdbRF6hn0SXErhjwoKu8u_iuZIU4QpAGfImxPKWMZqECcr4cvEyHEu-duPwksqemCyrzq_fc-AOP-mXrxpfDBLmBpiCxFkXcxrjaRtNmS75Nmhz3cm8VC70wiUq7WHxFCZvfsyc4.O_p4mPadiFpwsO7idLw7kA7ve5s4o41nLcSCxjY9yI4&dib_tag=se&keywords=ssd1306+oled+display+module&qid=1722470662&sprefix=ssd1306%2Caps%2C91&sr=8-6 "https://www.amazon.com/Teyleten-Robot-Display-SSD1306-Raspberry/dp/B08ZY4YBHL/ref=sr_1_6?crid=1X1ODCPMBG4T7&dib=eyJ2IjoiMSJ9.l-FK2pxw8wWhZ_wtkFb4O317I1KcEin8dQMamdyEitE9LRh2ASA0jqjkAPis8a7H8O0BVjGwVcOVrv74dr2MPFvqay2peW42GiRTdbRF6hn0SXErhjwoKu8u_iuZIU4QpAGfImxPKWMZqECcr4cvEyHEu-duPwksqemCyrzq_fc-AOP-mXrxpfDBLmBpiCxFkXcxrjaRtNmS75Nmhz3cm8VC70wiUq7WHxFCZvfsyc4.O_p4mPadiFpwsO7idLw7kA7ve5s4o41nLcSCxjY9yI4&dib_tag=se&keywords=ssd1306+oled+display+module&qid=1722470662&sprefix=ssd1306%2Caps%2C91&sr=8-6")                                                                                                                                                                                |                                                                                                                                                                                                                                | 1        | $2.38       |
| PCB                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          | ordered from JLCPCB (upload Gerber.zip file)                                                                                                                                                                                   | 1        | $8.90       |
| LL4148 Diodes, JLCPCB #C435829                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               | If you don't do assembly through JLCPCB, you can order these separately on DigiKey or other electronics suppliers                                                                                                              | 24       | $1.87       |
| [M3 x 12mm](https://www.mcmaster.com/95263A146/ "https://www.mcmaster.com/95263A146/") SH                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |                                                                                                                                                                                                                                | 4        | $0.71       |
| PLA                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |                                                                                                                                                                                                                                | ~100g    | $2.00       |
| **Total**                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |                                                                                                                                                                                                                                |          | $36.15      |

## Build Instructions

1. Solder keycaps, OLED, rotary encoder, and headers to PCB.
1. Print 3d files:
	- [ ] 4 feet (foot.stl)
	- [ ] 1 base
	- [ ] 1 lid
	- [ ] 24 keycaps (or use real keycaps if you have them). I used kailh box switches, which required a slimmer stem, so you might be able to find a model (or generator: https://github.com/rsheldiii/KeyV2) with a stronger stem for regular switches.
1. Place PCB inside base. You may have to trim some of the pin headers down if there's some interference.
2. Place lid over
3. Secure together using M3 bolts screwed in from the bottom
4. Put keycaps/Pro Micro on
5. Program! 
	- you can use the firmware I put together [here](https://github.com/jonuhthin/qmk_firmware/tree/cf84ea766289dee4de3f93f87dd316478ff13fd7) , modifying keymap.c to your needs
	- follow QMK's documentation [here](https://docs.qmk.fm/newbs) if you decide to make this keyboard to set up your environment
	- run `make jonuhthin_24k_3dp:default` to build the .hex file
	- flash the .hex file to your Pro Micro using [QMK's toolbox](https://github.com/qmk/qmk_toolbox)

## Notes/Future Changes

Although I _probably_ won't iterate on this design further, here are some things I'd change if I did:

- [ ] space the mounting holes out by a few mm so they don't get close to the keys/other components
- [ ] move away from using a rotary encoder with a breakout board and just use one directly. The current way requires cutting the pin headers down to avoid interference
- [ ] reorient the screen or use a bigger (128x64) oled module
- [ ] add bluetooth support

Since this was a one-off project, I didn't worry much about the customization aspect (i.e. making the keymaps editable). If I get enough people interested, I'll submit the keymap to the QMK tool so everyone can edit keymaps more easily using the browser application.